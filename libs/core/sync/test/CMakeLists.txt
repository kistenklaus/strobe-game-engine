set(STROBE_CORE_SYNC_TESTS ${STROBE_CORE_SYNC_LIB}-test)
set(STROBE_CORE_SYNC_TESTS_EXEC ${STROBE_CORE_SYNC_TESTS}-exec)


enable_testing()

add_library(${STROBE_CORE_SYNC_TESTS} 
  OBJECT EXCLUDE_FROM_ALL
  ${CMAKE_CURRENT_SOURCE_DIR}/LockFreeSPSCRingBuffer.cpp
  ${CMAKE_CURRENT_SOURCE_DIR}/LockFreeBoundedMSQueue.cpp
  ${CMAKE_CURRENT_SOURCE_DIR}/mpsc.cpp
  ${CMAKE_CURRENT_SOURCE_DIR}/spsc.cpp
)

target_compile_options(${STROBE_CORE_SYNC_TESTS} PUBLIC -g -O0)

target_link_googletest(${STROBE_CORE_SYNC_TESTS} PUBLIC)
target_link_libraries(${STROBE_CORE_SYNC_TESTS} PRIVATE ${STROBE_CORE_SYNC_LIB})
set_property(GLOBAL APPEND PROPERTY STROBE_TEST_LIBS ${STROBE_CORE_SYNC_TESTS})


add_executable(${STROBE_CORE_SYNC_TESTS_EXEC}
  ${CMAKE_CURRENT_SOURCE_DIR}/main.cpp
)

target_compile_options(${STROBE_CORE_SYNC_TESTS_EXEC} PUBLIC -g -O0)
target_link_libraries(${STROBE_CORE_SYNC_TESTS_EXEC} PRIVATE ${STROBE_CORE_SYNC_TESTS})

